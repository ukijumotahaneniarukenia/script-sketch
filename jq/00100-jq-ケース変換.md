パターン

```
$ perm-ruby 2 downcamel kebab screamsnake snake train upcamel
downcamel	kebab
downcamel	screamsnake
downcamel	snake
downcamel	train
downcamel	upcamel
kebab	downcamel
kebab	screamsnake
kebab	snake
kebab	train
kebab	upcamel
screamsnake	downcamel
screamsnake	kebab
screamsnake	snake
screamsnake	train
screamsnake	upcamel
snake	downcamel
snake	kebab
snake	screamsnake
snake	train
snake	upcamel
train	downcamel
train	kebab
train	screamsnake
train	snake
train	upcamel
upcamel	downcamel
upcamel	kebab
upcamel	screamsnake
upcamel	snake
upcamel	train
```





おしえてもらったやつ

addでjoinできる

|=で再代入

```
$ echo '{"u_un_unk_unko":"Pile of poo"}' | jq 'def snake2(e;sep):e/sep|.[0]+(.[1:]|map(./""|.[0]|=ascii_upcase|add)|add);.|with_entries(.key|=snake2(.;"_"))'
{
  "uUnUnkUnko": "Pile of poo"
}
```



IN

```
$ cat a.json
{
  "unko": "うんこ",
  "unko_mori": "うんこもり",
  "unko_mori_mori": "うんこもりもり"
}
```


CMD

```
$ cat a.json | jq '. as $in|keys|map(split("_") as $j|($j[:1][])+($j[1:]|map(split("") as $k|(($k[:1][]|ascii_upcase),($k[1:]|join(""))))|join(""))) as $newKeyList|($in|to_entries) as $itemList|[range(0;$itemList|length)]|map({"key":($newKeyList[.]),"value":$itemList[.].value})|from_entries'
```

OUT


```
{
  "unko": "うんこ",
  "unkoMori": "うんこもり",
  "unkoMoriMori": "うんこもりもり"
}
```


これがむずい

walk to_entries walk map walk from_entriesの一連

IN

```
$ cat b.json
{
  "cast": {
    "person": [
      {
        "role-name": "Mark Watney",
        "canonical-name": "Matt Damon"
      },
      {
        "role-name": "Melissa Lewis",
        "canonical-name": "Jessica Chastain"
      },
      {
        "role-name": "Annie Montrose",
        "canonical-name": "Kristen Wiig"
      }
    ]
  },
  "director": "Ridley Scott",
  "release-date": "2015-10-02",
  "mpaa-rating": "PG-13",
  "running-time": 144
}
```

これがだめなのがよくわからん

```
$ cat b.json |jq 'def a(e;sep): e|split(sep) as $j|($j[:1][])+($j[1:]|map(split("") as $k|(($k[:1][]|ascii_upcase),($k[1:]|join(""))))|join(""));walk(if type == "object" then to_entries else . end)|walk(if type=="object" and has("key") then .key |= a(.;"-") else . end)|walk(if (type == "object") then [.]|from_entries elif (type=="array") then from_entries else . end)'
jq: error (at <stdin>:22): Cannot use null (null) as object key
```

配列もいけると思ったが。。。

```
jq '
def snake2(e;sep):e/sep|.[0]+(.[1:]|map(./""|.[0]|=ascii_upcase|add)|add);
walk(if type == "object" then to_entries else . end)
|walk(if type=="object" and has("key") then .key |= snake2(.;"-") else . end)
|walk(if (type == "object") then [.]|from_entries elif (type=="array") then from_entries else . end)
' b.json
```

```
$ cat b.json |jq 'def a(e;sep): e|split(sep) as $j|($j[:1][])+($j[1:]|map(split("") as $k|(($k[:1][]|ascii_upcase),($k[1:]|join(""))))|join(""));walk(if type == "object" then to_entries else . end)|walk(if type=="object" and has("key") then .key |= a(.;"-") else . end)|walk(if (type == "object") then [.]|from_entries elif (type=="array") then . else . end)'
[
  {
    "cast": [
      {
        "person": [
          [
            {
              "roleName": "Mark Watney"
            },
            {
              "canonicalName": "Matt Damon"
            }
          ],
          [
            {
              "roleName": "Melissa Lewis"
            },
            {
              "canonicalName": "Jessica Chastain"
            }
          ],
          [
            {
              "roleName": "Annie Montrose"
            },
            {
              "canonicalName": "Kristen Wiig"
            }
          ]
        ]
      }
    ]
  },
  {
    "director": "Ridley Scott"
  },
  {
    "releaseDate": "2015-10-02"
  },
  {
    "mpaaRating": "PG-13"
  },
  {
    "runningTime": 144
  }
]
```


配列 in 配列は 結果をwalkでもちわまる必要がある

```
$ cat d.json
{
  "K": [
    {
      "roleName": "Melissa Lewis"
    },
    {
      "canonicalName": "Jessica Chastain"
    }
  ]
}

$ cat d.json | jq '.K'
[
  {
    "roleName": "Melissa Lewis"
  },
  {
    "canonicalName": "Jessica Chastain"
  }
]

$ cat d.json | jq '.K|add'
{
  "roleName": "Melissa Lewis",
  "canonicalName": "Jessica Chastain"
}


$ cat d.json | jq '.K|reduce .[] as $item({};.+$item)'
{
  "roleName": "Melissa Lewis",
  "canonicalName": "Jessica Chastain"
}


$ jq 'walk(if (type == "object") then [.]|from_entries elif (type=="array") then ([{"key":"K","value":.}])|from_entries|.K|reduce .[] as $item({};.+$item) else . end)' c.json 
{
  "cast": {
    "person": {
      "roleName": "Annie Montrose",
      "canonicalName": "Kristen Wiig"
    }
  },
  "director": "Ridley Scott",
  "releaseDate": "2015-10-02",
  "mpaaRating": "PG-13",
  "runningTime": 144
}
```
