#!/usr/bin/env bash

usage(){
cat <<EOS
Usage:
   IN: $0 sleep 0.5
  OUT:
0:00:50 [==============================================================================================================================================================================>] 100%

   or

   IN: $0 bash b.sh
  OUT:
0:00:29 [==============================================================================================================================================================================>] 100%

   or

   IN: $0 ./b.sh
  OUT:
0:00:29 [==============================================================================================================================================================================>] 100%


EOS

exit 0

}

main(){
  ARGS=($(cat -));

  CMD=${ARGS[@]}

  if [ -z "$CMD" ] ;then

    usage

  fi

  for x in {1..100} ; do eval "$CMD";printf .;done | pv -pt -i0.01 -s100 -w$(tput cols) -H$(tput lines) 1>/dev/null

}

[ -p /dev/stdin ] && usage
[ -p /dev/stdin ] || echo -ne "$@" | main
