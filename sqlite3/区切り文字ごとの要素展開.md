# セパレタを動的にした所存



# 正順

```
$cat ./segregate.sh
#!/bin/bash

printf "%s\n" {a..b}{,{,a}} | xargs | xargs -I@ bash -c 'sqlite3 testdb \
  "
  with recursive
    sub(rsv_args) as (select \"@\")
    ,rec(
      rn
      
      ,rsv_args
      ,rsv_args_len
      ,rsv_args_non_sep_len
      ,ele_cnt

      ,last_ele
      ,ele
      ,sep_pos

      ,rest_args
      ,rest_args_len
      ,rest_args_non_sep_len
    ) as (
      select
        -1

        ,rsv_args
        ,length(rsv_args)
        ,length(replace(rsv_args,\" \",\"\"))
        ,length(rsv_args)-length(replace(rsv_args,\" \",\"\"))+1
        
        ,null
        ,null
        ,0

        ,rsv_args
        ,length(rsv_args)
        ,length(replace(rsv_args,\" \",\"\"))
      from sub
      union all
      select
        rn+1

        ,rsv_args
        ,length(rsv_args)
        ,length(replace(rsv_args,\" \",\"\"))
        ,rsv_args_len-rsv_args_non_sep_len+1

        ,substr(rsv_args,1,instr(rsv_args,\" \"))
        ,case when rest_args_len-rest_args_non_sep_len=1 then rest_args else substr(rest_args,1,instr(rest_args,\" \")-1) end
        ,instr(rest_args,\" \")

        ,case when rest_args_len-rest_args_non_sep_len=1 then \"\" else substr(rest_args,instr(rest_args,\" \")+1) end
        ,length(rest_args)
        ,length(replace(rest_args,\" \",\"\"))
      from rec
      where rn<length(rsv_args)-length(replace(rsv_args,\" \",\"\")) 
  )select * from rec;
  "
' && rm testdb
```



```
$./segregate.sh
rn          rsv_args       rsv_args_len  rsv_args_non_sep_len  ele_cnt     last_ele    ele         sep_pos     rest_args      rest_args_len  rest_args_non_sep_len
----------  -------------  ------------  --------------------  ----------  ----------  ----------  ----------  -------------  -------------  ---------------------
-1          a a aa b b ba  13            8                     6           NULL        NULL        0           a a aa b b ba  13             8                    
0           a a aa b b ba  13            8                     6           a           a           2           a aa b b ba    13             8                    
1           a a aa b b ba  13            8                     6           a           a           2           aa b b ba      11             7                    
2           a a aa b b ba  13            8                     6           a           aa          3           b b ba         9              6                    
3           a a aa b b ba  13            8                     6           a           b           2           b ba           6              4                    
4           a a aa b b ba  13            8                     6           a           b           2           ba             4              3                    
5           a a aa b b ba  13            8                     6           a           ba          0                          2              2                    
```

# 逆順

```
$cat ./rev_segregate.sh
#!/bin/bash

printf "%s\n" {a..b}{,{,a}} | tac | xargs | xargs -I@ bash -c 'sqlite3 testdb \
  "
  with recursive
    sub(rsv_args) as (select \"@\")
    ,rec(
      rn
      
      ,rsv_args
      ,rsv_args_len
      ,rsv_args_non_sep_len
      ,ele_cnt

      ,last_ele
      ,ele
      ,sep_pos

      ,rest_args
      ,rest_args_len
      ,rest_args_non_sep_len
    ) as (
      select
        -1

        ,rsv_args
        ,length(rsv_args)
        ,length(replace(rsv_args,\" \",\"\"))
        ,length(rsv_args)-length(replace(rsv_args,\" \",\"\"))+1
        
        ,null
        ,null
        ,0

        ,rsv_args
        ,length(rsv_args)
        ,length(replace(rsv_args,\" \",\"\"))
      from sub
      union all
      select
        rn+1

        ,rsv_args
        ,length(rsv_args)
        ,length(replace(rsv_args,\" \",\"\"))
        ,rsv_args_len-rsv_args_non_sep_len+1

        ,substr(rsv_args,1,instr(rsv_args,\" \"))
        ,case when rest_args_len-rest_args_non_sep_len=1 then rest_args else substr(rest_args,1,instr(rest_args,\" \")-1) end
        ,instr(rest_args,\" \")

        ,case when rest_args_len-rest_args_non_sep_len=1 then \"\" else substr(rest_args,instr(rest_args,\" \")+1) end
        ,length(rest_args)
        ,length(replace(rest_args,\" \",\"\"))
      from rec
      where rn<length(rsv_args)-length(replace(rsv_args,\" \",\"\")) 
  )select * from rec;
  "
' && rm testdb
```

```
$./rev_segregate.sh
rn          rsv_args       rsv_args_len  rsv_args_non_sep_len  ele_cnt     last_ele    ele         sep_pos     rest_args      rest_args_len  rest_args_non_sep_len
----------  -------------  ------------  --------------------  ----------  ----------  ----------  ----------  -------------  -------------  ---------------------
-1          ba b b aa a a  13            8                     6           NULL        NULL        0           ba b b aa a a  13             8                    
0           ba b b aa a a  13            8                     6           ba          ba          3           b b aa a a     13             8                    
1           ba b b aa a a  13            8                     6           ba          b           2           b aa a a       10             6                    
2           ba b b aa a a  13            8                     6           ba          b           2           aa a a         8              5                    
3           ba b b aa a a  13            8                     6           ba          aa          3           a a            6              4                    
4           ba b b aa a a  13            8                     6           ba          a           2           a              3              2                    
5           ba b b aa a a  13            8                     6           ba          a           0                          1              1                    
```
